<?xml version="1.0" encoding="ISO-8859-1"?>

<service:service-group
   xmlns:service="http://pcm.framework.org/service"
	xmlns:xs="http://www.w3.org/2001/XMLSchema" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://pcm.framework.org/service services.xsd">

	<service name="GestionColaboradores" profile="ADMINISTRADOR, CONSULTOR_UTE">

		<action event="query" submitError="GestionColaboradores.query"
			submitSucces="GestionColaboradores.query">

			<viewComponent>

				<form columns="4" title="Gestion Colaboradores">

					<fieldViewSet entitymodel="colaborador" nameSpace="colaborador">
						<fieldView mappingTo="1" hidden="true"/>
						<fieldView mappingTo="2" size="30" />
						<fieldView mappingTo="3" size="50" />
						<fieldView mappingTo="5" />
						<fieldView mappingTo="13" type="select">
						 	<optionValues selectionMultiple="true" entitymodel="concurso"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						
						<fieldView separator="br" />
						<fieldView separator="br" />
						
						<fieldView mappingTo="6" type="select">
							<optionValues selectionMultiple="true" entitymodel="categoria_profesional"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="4" type="select">
							<optionValues selectionMultiple="true" entitymodel="responsabilidad" descrMappingTo="2">
							</optionValues>
						</fieldView>	
						<fieldView mappingTo="8" type="select">
							<optionValues selectionMultiple="true" entitymodel="empresaUTE"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="9" size="4" />

						<fieldView separator="br" />
						<fieldView separator="br" />

						<fieldView mappingTo="10" />
						<fieldView mappingTo="11" />
						<!-- <fieldView mappingTo="12" /> -->
					</fieldViewSet>
				</form>

				<grid title="Listado colaboradores" orderDirection="asc" defaultOrderField="colaborador.3"
					eventsRegistered="update,delete,create">

					<fieldViewSet entitymodel="colaborador" nameSpace="colaborador">
						<fieldView mappingTo="1" />
						<fieldView mappingTo="2" size="30" />
						<fieldView mappingTo="3" size="50" />
						<fieldView mappingTo="4" type="select">
							<optionValues entitymodel="responsabilidad" descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="5" />
						<fieldView mappingTo="13" type="select">
						 	<optionValues entitymodel="concurso"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="6" type="select">
							<optionValues entitymodel="categoria_profesional"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="8" type="select">
							<optionValues entitymodel="empresaUTE"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="9" />
						<fieldView mappingTo="10" />
						<fieldView mappingTo="11" />			
						<fieldView mappingTo="12" size="4" />
					</fieldViewSet>
				</grid>

			</viewComponent>

		</action>

		<action event="delete" submitError="GestionColaboradores.delete"
			submitSucces="GestionColaboradores.query" strategyPre="facturacionUte.strategies.concursos.StrategyBorrarAgregadosMesesColab">

			<viewComponent>
				<form columns="53" title="Borrado Colaborador">				
					<fieldViewSet entitymodel="colaborador" nameSpace="colaborador">
						<fieldView mappingTo="1" editable="false"/>
						<fieldView mappingTo="2" size="30" editable="false"/>
						<fieldView mappingTo="3" size="50" editable="false"/>
						<fieldView mappingTo="5" editable="false"/>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="13" type="select" editable="false">
						 	<optionValues entitymodel="concurso"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="6" type="select" editable="false">
							<optionValues entitymodel="categoria_profesional"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="4" type="select" editable="false">
							<optionValues entitymodel="responsabilidad" descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="8" type="select" editable="false">
							<optionValues entitymodel="empresaUTE"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="9" editable="false"/>
						<fieldView mappingTo="10" editable="false"/>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="11" editable="false"/>
						<fieldView mappingTo="12" editable="false"/>
					</fieldViewSet>
				</form>
				
				<grid title="Listado de aplicaciones asignadas a este colaborador" dependsOf="colaborador" orderDirection="asc"
					defaultOrderField="appColaborador.3" eventsRegistered="">					
					<fieldViewSet entitymodel="appColaborador"
						nameSpace="appColaborador">
						<fieldView mappingTo="1" hidden="true"/>								
						<fieldView mappingTo="3" type="select" editable="false">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>	
					</fieldViewSet>
				</grid>
				
			</viewComponent>
		</action>

		<action event="create" submitError="GestionColaboradores.create"
			submitSucces="GestionColaboradores.query"
			strategy="facturacionUte.strategies.concursos.StrategyCrearAgregadosMesesColab">

			<viewComponent>
				<form columns="53" title="Alta Colaborador">
					<fieldViewSet entitymodel="colaborador" nameSpace="colaborador">
						<fieldView mappingTo="2" size="30" />
						<fieldView mappingTo="3" size="50" />
						<fieldView mappingTo="5" />
						<fieldView mappingTo="13" type="select">
						 	<optionValues entitymodel="concurso"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="6" type="select">
							<optionValues entitymodel="categoria_profesional"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="4" type="select">
							<optionValues entitymodel="responsabilidad" descrMappingTo="2">
							</optionValues>
						</fieldView>	
						<fieldView mappingTo="8" type="select">
							<optionValues entitymodel="empresaUTE"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="9" />
						<fieldView mappingTo="10" />
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="11" />
						<fieldView mappingTo="12" />
						
					</fieldViewSet>
				</form>
			</viewComponent>
		</action>

		<action event="update" submitError="GestionColaboradores.update"
			submitSucces="GestionColaboradores.update"
			strategy="facturacionUte.strategies.concursos.StrategyCrearAgregadosMesesColab">

			<viewComponent>
				<form columns="53" title="Edicion Colaborador">
				
					<userbuttons>

						<button link="BarChartStatsServlet" id="barchart1"
							name="Barchart">
							<fieldViewSet nameSpace="barchart1">
								<fieldView name="entidadGrafico" hidden="true" value="facturacionMesPorColaborador"/>
								<fieldView name="filteredByField" hidden="true" value="4=colaborador.1;2=filtroStats.anyo;3=filtroStats.mes"/>
								<fieldView name="orderBy" hidden="true" value="2"/>							
								<fieldView name="fieldForGroupBy" type="select">
									<optionValues selectionMultiple="true">
										<option code="2" title="anualidades"></option>
										<option code="3" title="mensualidades"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="10" title="horas imputadas"></option>
										<option code="5" title="facturado"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="6" title="% facturado concurso"></option>
										<option code="7" title="% facturado servicio"></option>
										<option code="8" title="% facturado dpto."></option>
										<option code="9" title="% facturado aplicacion"></option>
									</optionValues>
								</fieldView>
								<fieldView name="operation" hidden="true" value="SUM"/>								
							</fieldViewSet>
						</button>
						
						<button	link="Histogram3DStatsServlet" id="histParam" 
							name="Histogram" >
							<fieldViewSet nameSpace="histParam">
								<fieldView name="entidadGrafico" hidden="true" value="facturacionMesPorColaborador"/>
								<fieldView name="filteredByField" hidden="true" value="4=colaborador.1;2=filtroStats.anyo;3=filtroStats.mes"/>
								<fieldView name="orderBy" hidden="true" value="2"/>							
								<fieldView name="fieldForGroupBy" type="select">
									<optionValues selectionMultiple="true">
										<option code="2" title="anualidades"></option>
										<option code="3" title="mensualidades"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="10" title="horas imputadas"></option>
										<option code="5" title="facturado"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="6" title="% facturado concurso"></option>
										<option code="7" title="% facturado servicio"></option>
										<option code="8" title="% facturado dpto."></option>
										<option code="9" title="% facturado aplicacion"></option>
									</optionValues>
								</fieldView>
								<fieldView name="operation" hidden="true" value="SUM"/>								
							</fieldViewSet>
						</button>
						
						<button link="PieChartStatsServlet" id="piechartParam"
							name="Piechart">
							<fieldViewSet nameSpace="piechartParam">
								<fieldView name="entidadGrafico" hidden="true" value="facturacionMesPorColaborador"/>
								<fieldView name="filteredByField" hidden="true" value="4=colaborador.1;2=filtroStats.anyo;3=filtroStats.mes"/>
								<fieldView name="orderBy" hidden="true" value="2"/>							
								<fieldView name="fieldForGroupBy" type="select">
									<optionValues selectionMultiple="true">
										<option code="2" title="anualidades"></option>
										<option code="3" title="mensualidades"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="10" title="horas imputadas"></option>
										<option code="5" title="facturado"></option>
									</optionValues>
								</fieldView>
								<fieldView name="agregado" type="select">
									<optionValues>
									    <option code="6" title="% facturado concurso"></option>
										<option code="7" title="% facturado servicio"></option>
										<option code="8" title="% facturado dpto."></option>
										<option code="9" title="% facturado aplicacion"></option>
									</optionValues>
								</fieldView>
								<fieldView name="operation" hidden="true" value="SUM"/>								
							</fieldViewSet>
						</button>
						
					</userbuttons>
					
					<fieldViewSet entitymodel="colaborador" nameSpace="colaborador">
						<fieldView mappingTo="1" editable="false"/>
						<fieldView mappingTo="2" size="30" />
						<fieldView mappingTo="3" size="50" />
						<fieldView mappingTo="5" />						 
						<fieldView mappingTo="13" type="select" editable="false">
						 	<optionValues entitymodel="concurso"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						
						<fieldView separator="br" />
						<fieldView separator="br" />
						
						<fieldView mappingTo="6" type="select">
							<optionValues entitymodel="categoria_profesional"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView separator="br" />
						<fieldView separator="br" />
						
						<fieldView mappingTo="4" type="select">
							<optionValues entitymodel="responsabilidad" descrMappingTo="2">
							</optionValues>
						</fieldView>	
						<fieldView mappingTo="8" type="select">
							<optionValues entitymodel="empresaUTE"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="9" />
						<fieldView mappingTo="10" />

						<fieldView separator="br" />
						<fieldView separator="br" />

						<fieldView mappingTo="11" />
						<fieldView mappingTo="12" />
					</fieldViewSet>
					
					<fieldViewSet nameSpace="filtroStats">
						<fieldView name="mes" type="select">
							<optionValues selectionMultiple="true">
								<option code="1" title="ene"></option>
								<option code="2" title="feb"></option>
								<option code="3" title="marzo"></option>
								<option code="4" title="abril"></option>
								<option code="5" title="mayo"></option>
								<option code="6" title="junio"></option>
								<option code="7" title="julio"></option>
								<option code="8" title="ago"></option>
								<option code="9" title="sept"></option>
								<option code="10" title="oct"></option>
								<option code="11" title="nov"></option>
								<option code="12" title="dic"></option>
							</optionValues>
						</fieldView>
						<fieldView name="anyo" type="select">
							<optionValues selectionMultiple="true">
								<option code="2017" title="2017"></option>
								<option code="2018" title="2018"></option>
								<option code="2019" title="2019"></option>
							</optionValues>
						</fieldView>
					</fieldViewSet>
					
				</form>					
				
				<grid title="Listado de aplicaciones asignadas a este colaborador" dependsOf="colaborador" orderDirection="asc"
					defaultOrderField="appColaborador.3" eventsRegistered="create,delete"
					serviceRef="GestionColaboradorApps">
					<fieldViewSet entitymodel="appColaborador"
						nameSpace="appColaborador">
						<fieldView mappingTo="1" hidden="true"/>								
						<fieldView mappingTo="3" type="select">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>	
					</fieldViewSet>
				</grid>
				
				<grid title="Listado de mensualidades de facturacion de este colaborador" dependsOf="colaborador" orderDirection="asc"
					defaultOrderField="facturacionMesPorColaborador.1" eventsRegistered="update"
					serviceRef="GestionFactMesPorColaborador">
					<fieldViewSet entitymodel="facturacionMesPorColaborador"
						nameSpace="facturacionMesPorColaborador">
						<fieldView mappingTo="1" hidden="true" />
						<fieldView mappingTo="2" />
						<fieldView mappingTo="3" type="select">
							<optionValues entitymodel="mes"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="5" styleCss="font-weight: bold;color: blue;" />
						<fieldView mappingTo="6" styleCss="font-weight: bold;color: black;" />
						<fieldView mappingTo="7" styleCss="font-weight: bold;color: red;" />
						<fieldView mappingTo="8" styleCss="font-weight: bold;color: red;" />
						<fieldView mappingTo="9" styleCss="font-weight: bold;color: red;" />
						<fieldView mappingTo="10" styleCss="font-weight: bold;color: red;" />
					</fieldViewSet>
				</grid>
				
			</viewComponent>
		</action>
			
	</service>
	
	<service name="GestionColaboradorApps" profile="ADMINISTRADOR, CONSULTOR_UTE">
		
		<action event="delete" submitError="GestionColaboradorApps.delete"
			submitSucces="GestionColaboradores.update"
			strategy="facturacionUte.strategies.concursos.StrategyBorrarUTsMesColabyApp">

			<viewComponent>
				<form columns="53" title="Desasignar app a colaborador">
					<fieldViewSet entitymodel="appColaborador" nameSpace="appColaborador">
						<fieldView mappingTo="1" hidden="true"/>
						
						<fieldView mappingTo="2" type="select" editable="false">
							<optionValues entitymodel="colaborador"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>

						<fieldView separator="br" />
						<fieldView separator="br" />		
						
						<fieldView mappingTo="3" type="select" editable="false">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>
												
					</fieldViewSet>
				</form>
			</viewComponent>
		</action>

		<action event="create" submitError="GestionColaboradorApps.create"
			submitSucces="GestionColaboradores.update"
			strategyPre="facturacionUte.strategies.concursos.StrategySeleccionColabyApp"
			strategy="facturacionUte.strategies.concursos.StrategyGrabarUTsMesColabyApp">

			<viewComponent>
				<form columns="53" title="Asignar app a colaborador">
					<fieldViewSet entitymodel="appColaborador" nameSpace="appColaborador">
						
						<fieldView mappingTo="2" type="select">
							<optionValues entitymodel="colaborador"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>
						
						<fieldView separator="br" />
						<fieldView separator="br" />
						
						<fieldView mappingTo="3" type="select">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>
																
					</fieldViewSet>
				</form>
			</viewComponent>
		</action>
		
	</service>
	
	<service name="GestionFactMesPorColaborador" profile="ADMINISTRADOR, CONSULTOR_UTE">
		
		<action event="update" submitError="GestionFactMesPorColaborador.update"
			submitSucces="GestionFactMesPorColaborador.update">

			<viewComponent>
				<form columns="53" title="Edicion mes facturacion">
					<fieldViewSet entitymodel="facturacionMesPorColaborador" nameSpace="facturacionMesPorColaboradorForm">
						<fieldView mappingTo="1" hidden="true"/>
						<fieldView mappingTo="2" editable="false"/>
						<fieldView mappingTo="3" type="select" editable="false">
							<optionValues entitymodel="mes"
								descrMappingTo="2">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="4" type="select" editable="false">
							<optionValues entitymodel="colaborador"
								descrMappingTo="2,3">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="10" styleCss="font-weight: bold;color: black;" editable="false"/>
						<fieldView mappingTo="5" styleCss="font-weight: bold;color: black;" editable="false"/>
						<fieldView separator="br" />
						<fieldView separator="br" />
						<fieldView mappingTo="6" styleCss="font-weight: bold;color: red;" editable="false"/>
						<fieldView mappingTo="7" styleCss="font-weight: bold;color: red;" editable="false"/>
						<fieldView mappingTo="8" styleCss="font-weight: bold;color: red;" editable="false"/>
						<fieldView mappingTo="9" styleCss="font-weight: bold;color: red;" editable="false"/>
						
					</fieldViewSet>
				</form>
				
				<grid title="Imputaciones por aplicacion de este colaborador" dependsOf="facturacionMesPorColaboradorForm" orderDirection="asc"
					defaultOrderField="facturacionMesPorColaboradoryApp.1" eventsRegistered="update"
					serviceRef="GestionFactMesPorColaboradoryApp">
					<fieldViewSet entitymodel="facturacionMesPorColaboradoryApp"
						nameSpace="facturacionMesPorColaboradoryApp">
						<fieldView mappingTo="1" hidden="true" />
						<fieldView mappingTo="3" hidden="true" />
						<fieldView mappingTo="4" type="select">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2, 3">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="5" styleCss="font-weight: bold;color: black;" />		
					</fieldViewSet>
				</grid>
				
			</viewComponent>
		</action>		
		
	</service>
	
	<service name="GestionFactMesPorColaboradoryApp" profile="ADMINISTRADOR, CONSULTOR_UTE">
		
		<action event="update" submitError="GestionFactMesPorColaboradoryApp.update"
			submitSucces="GestionFactMesPorColaboradoryApp.update" strategyPre="facturacionUte.strategies.concursos.StrategyRecalculateFacturacionMes">

			<viewComponent>
				<form columns="53" title="Imputar mes por aplicacion">
					<fieldViewSet entitymodel="facturacionMesPorColaboradoryApp" nameSpace="facturacionMesPorColaboradoryAppForm">
						<fieldView mappingTo="1" hidden="true" />
						<fieldView mappingTo="8" hidden="true" />
						<fieldView mappingTo="6" hidden="true" />
						<fieldView mappingTo="2" hidden="true" />						
						<fieldView mappingTo="3" type="select" editable="false">
							<optionValues entitymodel="colaborador"
								descrMappingTo="2, 3">
							</optionValues>
						</fieldView>
						<fieldView mappingTo="4" type="select" editable="false">
							<optionValues entitymodel="proyecto"
								descrMappingTo="2, 3">
							</optionValues>
						</fieldView>						
						<fieldView mappingTo="5" />
					</fieldViewSet>
				</form>
				
			</viewComponent>
		</action>		
		
	</service>
		
</service:service-group>